@{
    ViewData["Title"] = "Resumen";
}


<section class="content-header">
    <h1>
        Resumen
        <small>Proceso actual</small>
    </h1>
</section>

<!-- Main content -->
<section class="content resumen-actual">

    <!--Resumen del proceso actual-->

    <div class="row">

        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
            <div class="form-group">
                <select class="form-control select2" id="numeroOrden" onchange="seleccionarOrden()">
                    <option disabled selected value="null">Seleccione una orden</option>
                </select>
            </div>
            <p>
                <dl class="dl-horizontal" style="color:white">
                    <dt>Cliente</dt>
                    <dd id="cliente">-</dd>
                    <dt>SKU</dt>
                    <dd id="SKU">-</dd>
                    <dt>N° de prioridad</dt>
                    <dd id="secuencia">-</dd>
                    <dt>Cantidad de botellas planificadas</dt>
                    <dd id="cantBotellasPlan">-</dd>
                    <dt>Cantidad de cajas planificada</dt>
                    <dd id="cantCajasPlan">-</dd>
                    <dt>Estado</dt>
                    <dd id="estado">-</dd>
                </dl>
            </p>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-12 text-right">
            <p style="color:white;">Última actualización: <span id="horaActualizacionIndicadoresOrden">--:--</span>hrs</p>
        </div>
        <div class="col-md-3 col-sm-6 col-xs-12">
            <div class="info-box bg-gray">
                <span class="info-box-icon"><i class="fa fa-thumbs-o-up"></i></span>

                <div class="info-box-content">
                    <span class="info-box-text">Botellas contabilizadas</span>
                    <span class="info-box-number" id="cantBotellas">-</span>

                    <div class="progress" id="progresoBotellas">
                        <!--div class="progress-bar" style="width: 70%"></div-->
                    </div>
                    <span class="progress-description" id="porcentBotellas">-% de avance</span>
                </div>
                <!-- /.info-box-content -->
            </div>
            <!-- /.info-box -->
        </div>
        <!-- ./col -->

        <div class="col-md-3 col-sm-6 col-xs-12">
            <div class="info-box bg-gray">
                <span class="info-box-icon"><i class="fa fa-bookmark-o"></i></span>

                <div class="info-box-content">
                    <span class="info-box-text">Cajas finalizadas</span>
                    <span class="info-box-number" id="cantCajas">-</span>

                    <div class="progress" id="progresoCajas">
                        <!--div class="progress-bar" style="width: 70%"></div-->
                    </div>
                    <span class="progress-description" id="porcentCajas">
                        -% de avance
                    </span>
                </div>
                <!-- /.info-box-content -->
            </div>
            <!-- /.info-box -->
        </div>
        <!-- ./col -->
        <div class="col-md-3 col-sm-6 col-xs-12">
            <div class="info-box">
                <span class="info-box-icon"><i class="fa fa-star-o"></i></span>

                <div class="info-box-content">
                    <span class="info-box-text">Cantidad de botella por minuto</span>
                    <span class="info-box-number" id="cantBotellasMin">-</span>
                </div>
                <!-- /.info-box-content -->
            </div>
            <!-- /.info-box -->
        </div>
        <!-- ./col -->
        <div class="col-md-3 col-sm-6 col-xs-12">
            <div class="info-box">
                <span class="info-box-icon"><i class="fa fa-files-o"></i></span>

                <div class="info-box-content">
                    <span class="info-box-text">Cantidad de cajas por minuto</span>
                    <span class="info-box-number" id="cantCajasMin">-</span>
                </div>
                <!-- /.info-box-content -->
            </div>
            <!-- /.info-box -->
        </div>
        <!-- ./col -->
    </div>
    <!-- /.row -->
    <!-- Main row -->
    <div class="row">
        <section class="col-xs-12 connectedSortable">
            <!-- Custom tabs (Charts with tabs)-->
            <div class="nav-tabs-custom">
                <!-- Tabs within a box -->
                <ul class="nav nav-tabs pull-right">
                    <li class="pull-left header"><i class="fa fa-inbox"></i> Cantidad de botellas y cajas por hora</li>
                </ul>

                <div id="chartdiv1"></div>

                <div class="tab-content no-padding">
                    <!-- Morris chart - Sales -->
                    <!--div class="chart tab-pane active" id="revenue-chart" style="position: relative; height: 200px;"></div-->
                    <!--div class="container"-->
                    <!--div id="loadingMessage"></div>
                    <canvas id="myChart" height="100"></canvas-->
                    <!--/div-->
                    <!-- HTML -->


                </div>
            </div>
            <!-- /.nav-tabs-custom -->
        </section>
        <!-- Left col -->
    </div>
    <!-- /.row (main row) -->
</section>



<section class="content-header">
    <h1>
        Resumen
        <small>Del día</small>
    </h1>
</section>

<!-- Main content -->
<section class="content">
    <div class="row">
        <div class="col-lg-12 text-right">
            <p style="color:black;">Última actualización: <span id="horaActualizacionIndicadoresDia">--:--</span>hrs</p>
        </div>
        <div class="col-md-3 col-sm-6 col-xs-12">
            <div class="info-box bg-gray">
                <span class="info-box-icon"><i class="fa fa-thumbs-o-up"></i></span>

                <div class="info-box-content">
                    <span class="info-box-text">Botellas contabilizadas</span>
                    <span class="info-box-number" id="cantBotellasDia">-</span>

                    <div class="progress" id="progresoBotellasDia">
                        <!--div class="progress-bar" style="width: 15%"></div-->
                    </div>
                    <span class="progress-description" id="porcentBotellasDia">-% de avance</span>
                </div>
                <!-- /.info-box-content -->
            </div>
            <!-- /.info-box -->
        </div>
        <!-- ./col -->

        <div class="col-md-3 col-sm-6 col-xs-12">
            <div class="info-box bg-gray">
                <span class="info-box-icon"><i class="fa fa-bookmark-o"></i></span>

                <div class="info-box-content">
                    <span class="info-box-text">Cajas finalizadas</span>
                    <span class="info-box-number" id="cantCajasDia">-</span>

                    <div class="progress" id="progresoCajasDia">
                        <!--div class="progress-bar" style="width: 70%"></div-->
                    </div>
                    <span class="progress-description" id="porcentCajasDia">-% de avance</span>
                </div>
                <!-- /.info-box-content -->
            </div>
            <!-- /.info-box -->
        </div>
        <!-- ./col -->

        <div class="col-md-3 col-sm-6 col-xs-12">
            <div class="info-box bg-gray">
                <span class="info-box-icon"><i class="fa fa-calendar"></i></span>

                <div class="info-box-content">
                    <span class="info-box-text">Ordenes Finalizadas</span>
                    <span class="info-box-number" id="cantOrdenesDia">-</span>

                    <div class="progress" id="progresoOrdenesDia">
                        <!--div class="progress-bar" style="width: 0%"></div-->
                    </div>
                    <span class="progress-description" id="porcentOrdenesDia">-% de avance</span>
                </div>
                <!-- /.info-box-content -->
            </div>
            <!-- /.info-box -->
        </div>
        <!-- /.col -->

        <div class="col-md-3 col-sm-6 col-xs-12">
            <div class="info-box bg-gray">
                <span class="info-box-icon"><i class="fa fa-comments-o"></i></span>

                <div class="info-box-content">
                    <span class="info-box-text">Avance por hora</span>
                    <span class="info-box-number" id="porcentajePorHora">-%</span>

                    <!--span class="info-box-number">30</span-->

                    <div class="progress" id="progresoPorHora">
                        <!--div class="progress-bar" style="width: 5%"></!div-->
                    </div>
                    <span class="progress-description" id="horaPorcentaje">Hora del avance: --:--</span>
                </div>
                <!-- /.info-box-content -->
            </div>
            <!-- /.info-box -->
        </div>
        <!-- /.col -->
    </div>

    <div class="row">
        <section class="col-xs-12 connectedSortable">
            <!-- Custom tabs (Charts with tabs)-->
            <div class="nav-tabs-custom">
                <!-- Tabs within a box -->
                <ul class="nav nav-tabs pull-right">
                    <li class="pull-left header"><i class="fa fa-inbox"></i> Cajas por hora</li>
                </ul>
                <div class="tab-content no-padding">
                    <!-- Morris chart - Sales -->
                    <!--div class="chart tab-pane active" id="revenue-chart" style="position: relative; height: 300px;"></div-->
                    <div id="chartdiv"></div>
                </div>
            </div>
            <!-- /.nav-tabs-custom -->
        </section>
        <!-- /.Left col -->
    </div>

    <div class="row">
        <div class="col-md-12">
            <div class="box">
                <div class="box-header with-border">
                    <h3 class="box-title">Resumen de ordenes</h3>
                </div>
                <!-- /.box-header -->
                <div class="box-body">
                    <table id="tabla" class="table table-bordered display dt-responsive" cellspacing="0" width="100%">
                        <thead>
                            <tr>
                                <th>Prioridad</th>
                                <th>Orden</th>
                                <th>Cliente</th>
                                <th>Estado</th>
                                <th>Progreso</th>
                                <th style="width: 40px">% del progreso</th>
                            </tr>
                        </thead>
                    </table>
                </div>
            </div>
        </div>
    </div>
</section>

<!--   Datatables-->
<script type="text/javascript" src="https://cdn.datatables.net/v/bs4/dt-1.10.20/datatables.min.js"></script>
<!-- extension responsive -->
<script src="https://cdn.datatables.net/responsive/2.2.3/js/dataTables.responsive.min.js"></script>
<!--Acciones para las ordenes e indicadores-->
<script type="text/javascript" src="~/js/resumen.js"></script>
<script>
    function seleccionarOrden() {
        var modelo = @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(Model, Newtonsoft.Json.Formatting.Indented));
        mostrarOrden(modelo);
    }
</script>

<script>
    $(document).ready(function ()
    {
        var modelo = @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(Model,Newtonsoft.Json.Formatting.Indented));
        document.getElementById("horaActualizacionIndicadoresOrden").innerHTML = obtenerHora();
        document.getElementById("horaActualizacionIndicadoresDia").innerHTML = obtenerHora();
        iniciarOrdenesSelect(modelo);
        indicadoresDia();
        indicadorCantBotellasHora();
        $.fn.DataTable.ext.pager.numbers_length = 4;
        mostrarTablaOrdenes();
    });
</script>


<script>
    function actualizarIndicadores() {
        var modelo = @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(Model, Newtonsoft.Json.Formatting.Indented));
        var ordenSelect = document.getElementById("numeroOrden");
        var numeroOrden = ordenSelect.options[ordenSelect.selectedIndex].value;
        for (var i = 0; modelo!=null && i < modelo.length; i++) {
            if (modelo[i]["Estado"] == 1 && numeroOrden == modelo[i]["OrdenFabricacion"]) {
                monitoreo(numeroOrden, modelo[i]["BotellasPlanificadas"], modelo[i]["CajasPlanificadas"])
                break;
            }
        }
        indicadoresDia();
        document.getElementById("horaActualizacionIndicadoresOrden").innerHTML = obtenerHora();
        document.getElementById("horaActualizacionIndicadoresDia").innerHTML = obtenerHora();

        
    }
    setInterval(actualizarIndicadores, 60*1000);

    function actualizarIndicadorHora()
    {
        indicadorCantBotellasHora();
    }
    setInterval(actualizarIndicadorHora, 60*60*1000);
</script>

<!-- Resources -->
<script src="https://www.amcharts.com/lib/4/core.js"></script>
<script src="https://www.amcharts.com/lib/4/charts.js"></script>
<script src="https://www.amcharts.com/lib/4/themes/dataviz.js"></script>
<script src="https://www.amcharts.com/lib/4/themes/animated.js"></script>

<!-- Chart code -->
<script>
    am4core.ready(function () {

        // Themes begin
        am4core.useTheme(am4themes_dataviz);
        am4core.useTheme(am4themes_animated);
        // Themes end

        // Create chart
        var chart = am4core.create("chartdiv", am4charts.XYChart);
        chart.paddingRight = 20;

        chart.data = generateChartData();

        var dateAxis = chart.xAxes.push(new am4charts.DateAxis());
        dateAxis.baseInterval = {
            "timeUnit": "minute",
            "count": 1
        };
        dateAxis.tooltipDateFormat = "HH:mm, d MMMM";

        var valueAxis = chart.yAxes.push(new am4charts.ValueAxis());
        valueAxis.tooltip.disabled = true;
        valueAxis.title.text = "Cantidad de cajas";
        valueAxis.renderer.ticks.template.disabled = true;

        var series = chart.series.push(new am4charts.LineSeries());
        series.dataFields.dateX = "fecha";
        series.dataFields.valueY = "cajas";
        series.tooltipText = "Cajas: [bold]{valueY}[/]";
        series.fillOpacity = 0.3;

        var bullet = series.bullets.push(new am4charts.CircleBullet());
        bullet.circle.radius = 6;
        bullet.circle.fill = am4core.color("#fff");
        bullet.circle.strokeWidth = 3;


        chart.cursor = new am4charts.XYCursor();
        chart.cursor.lineY.opacity = 0;
        chart.scrollbarX = new am4charts.XYChartScrollbar();
        chart.scrollbarX.series.push(series);


        dateAxis.start = 0.8;
        dateAxis.keepSelection = true;

        function generateChartData() {
            var chartData = [];
            // obtiene la fecha actual
            var firstDate = new Date();
            // obtiene la hora de 500 min antes
            firstDate.setMinutes(firstDate.getDate() - 500);

            // genera 500 instancias de datos
            var cajas = 500;
            for (var i = 0; i < 500; i += 30) {
                var nuevaFecha = new Date(firstDate);
                // genera el minto en que se obtiene la caja
                nuevaFecha.setMinutes(nuevaFecha.getMinutes() + i);
                // genera un numero random que sera el numero de cjas por hora
                cajas += Math.round((Math.random() < 0.5 ? 1 : -1) * Math.random() * 10);
                // agrega los datos a un arreglo
                chartData.push({
                    fecha: nuevaFecha,
                    cajas: cajas
                });
            }
            return chartData;
        }

    }); // end am4core.ready()
</script>


<!--Grafico principal version 1-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.js"></script>
<!--script src="https://code.jquery.com/jquery-3.3.1.min.js"></script-->
<!--script type="text/javascript" src="~/js/myChart.js"></script-->

<!--script>
    $(document).ready(
        function () {
            getChartData();
        });
</script-->

<style>
    #chartdiv {
        width: 100%;
        height: 350px;
    }

    #area-chart {
        min-height: 250px;
    }
</style>

<style>
    .container {
        width: 100%;
        height: 35%;
        position: relative;
    }

    #loadingMessage {
        position: absolute;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
    }
</style>


<!--Grafico principal version 2-->
<!-- Styles -->
<style>
    #chartdiv1 {
        width: 100%;
        height: 500px;
    }
</style>

<!-- Chart code -->
<script>
    am4core.ready(function () {

        // Themes begin
        am4core.useTheme(am4themes_dataviz);
        am4core.useTheme(am4themes_animated);
        // Themes end

        var chart = am4core.create("chartdiv1", am4charts.XYChart);

        chart.data = [{
            "hour": "08:30",
            "Botellas": 1587,
            "Cajas": 650
        }, {
            "hour": "08:35",
            "Botellas": 1567,
            "Cajas": 683
        }, {
            "hour": "08:40",
            "Botellas": 1617,
            "Cajas": 691
        }, {
            "hour": "08:45",
            "Botellas": 1630,
            "Cajas": 642
        }, {
            "hour": "08:50",
            "Botellas": 1660,
            "Cajas": 699
        }, {
            "hour": "08:55",
            "Botellas": 1683,
            "Cajas": 721
        }, {
            "hour": "09:00",
            "Botellas": 1691,
            "Cajas": 737
        }, {
            "hour": "09:05",
            "Botellas": 1298,
            "Cajas": 680
        }, {
            "hour": "09:10",
            "Botellas": 1275,
            "Cajas": 664
        }, {
            "hour": "09:15",
            "Botellas": 1246,
            "Cajas": 648
        }, {
            "hour": "09:20",
            "Botellas": 1318,
            "Cajas": 697
        }, {
            "hour": "09:25",
            "Botellas": 1213,
            "Cajas": 633
        }, {
            "hour": "09:30",
            "Botellas": 1199,
            "Cajas": 621
        }, {
            "hour": "09:35",
            "Botellas": 1110,
            "Cajas": 210
        }, {
            "hour": "09:40",
            "Botellas": 1165,
            "Cajas": 232
        }, {
            "hour": "09:45",
            "Botellas": 1145,
            "Cajas": 219
        }, {
            "hour": "09:50",
            "Botellas": 1163,
            "Cajas": 201
        }, {
            "hour": "09:55",
            "Botellas": 1180,
            "Cajas": 285
        }, {
            "hour": "10:00",
            "Botellas": 1159,
            "Cajas": 277
        }];

        chart.dateFormatter.inputDateFormat = "HH:mm";
        var dateAxis = chart.xAxes.push(new am4charts.DateAxis());
        dateAxis.renderer.minGridDistance = 60;
        dateAxis.startLocation = 0.5;
        dateAxis.endLocation = 0.5;
        dateAxis.baseInterval = {
            timeUnit: "minute",
            count: 1
        }

        var valueAxis = chart.yAxes.push(new am4charts.ValueAxis());
        valueAxis.tooltip.disabled = true;

        var series = chart.series.push(new am4charts.LineSeries());
        series.dataFields.dateX = "hour";
        series.name = "Botellas";
        series.dataFields.valueY = "Botellas";
        series.tooltipHTML = "<img src='img/vino.png' style='vertical-align:bottom; margin-right: 10px; width:24px; height:24px;'><span style='font-size:14px; color:#000000;'><b>{valueY.value}</b></span>";
        series.tooltipText = "[#000]{valueY.value}[/]";
        series.tooltip.background.fill = am4core.color("#FFF");
        series.tooltip.getStrokeFromObject = true;
        series.tooltip.background.strokeWidth = 3;
        series.tooltip.getFillFromObject = false;
        series.fillOpacity = 0.6;
        series.strokeWidth = 2;
        series.stacked = true;

        var bullet = series.bullets.push(new am4charts.CircleBullet());
        bullet.circle.radius = 6;
        bullet.circle.fill = am4core.color("#fff");
        bullet.circle.strokeWidth = 3;


        var series2 = chart.series.push(new am4charts.LineSeries());
        series2.name = "Cajas";
        series2.dataFields.dateX = "hour";
        series2.dataFields.valueY = "Cajas";
        series2.tooltipHTML = "<img src='img/botellas-de-vino.png' style='vertical-align:bottom; margin-right: 10px; width:24px; height:24px;'><span style='font-size:14px; color:#000000;'><b>{valueY.value}</b></span>";
        series2.tooltipText = "[#000]{valueY.value}[/]";
        series2.tooltip.background.fill = am4core.color("#FFF");
        series2.tooltip.getFillFromObject = false;
        series2.tooltip.getStrokeFromObject = true;
        series2.tooltip.background.strokeWidth = 3;
        series2.sequencedInterpolation = true;
        series2.fillOpacity = 0.6;
        series2.stacked = true;
        series2.strokeWidth = 2;

        var bullet2 = series2.bullets.push(new am4charts.CircleBullet());
        bullet2.circle.radius = 6;
        bullet2.circle.fill = am4core.color("#fff");
        bullet2.circle.strokeWidth = 3;

        /*var series3 = chart.series.push(new am4charts.LineSeries());
        series3.name = "bicycles";
        series3.dataFields.dateX = "year";
        series3.dataFields.valueY = "bicycles";
        series3.tooltipHTML = "<img src='https://www.amcharts.com/lib/3/images/bicycle.png' style='vertical-align:bottom; margin-right: 10px; width:28px; height:21px;'><span style='font-size:14px; color:#000000;'><b>{valueY.value}</b></span>";
        series3.tooltipText = "[#000]{valueY.value}[/]";
        series3.tooltip.background.fill = am4core.color("#FFF");
        series3.tooltip.getFillFromObject = false;
        series3.tooltip.getStrokeFromObject = true;
        series3.tooltip.background.strokeWidth = 3;
        series3.sequencedInterpolation = true;
        series3.fillOpacity = 0.6;
        series3.defaultState.transitionDuration = 1000;
        series3.stacked = true;
        series3.strokeWidth = 2;*/

        chart.cursor = new am4charts.XYCursor();
        chart.cursor.xAxis = dateAxis;
        chart.scrollbarX = new am4core.Scrollbar();

        // Add a legend
        chart.legend = new am4charts.Legend();
        chart.legend.position = "top";

        // axis ranges
        /*var range = dateAxis.axisRanges.create();
        range.date = new Date(2001, 0, 1);
        range.endDate = new Date(2003, 0, 1);
        range.axisFill.fill = chart.colors.getIndex(7);
        range.axisFill.fillOpacity = 0.2;

        range.label.text = "Fines for speeding increased";
        range.label.inside = true;
        range.label.rotation = 90;
        range.label.horizontalCenter = "right";
        range.label.verticalCenter = "bottom";*/

        /*var range2 = dateAxis.axisRanges.create();
        range2.date = new Date(2007, 0, 1);
        range2.grid.stroke = chart.colors.getIndex(7);
        range2.grid.strokeOpacity = 0.6;
        range2.grid.strokeDasharray = "5,2";


        range2.label.text = "Motorcycle fee introduced";
        range2.label.inside = true;
        range2.label.rotation = 90;
        range2.label.horizontalCenter = "right";
        range2.label.verticalCenter = "bottom";*/

    }); // end am4core.ready()
</script>

